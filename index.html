<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PDFLY - PDF Tools</title>
<style>
  :root {
    --primary-color: #3f51b5;
    --bg-color: #f5f7fa;
    --text-color: #333;
  }
  body {
    margin: 0; font-family: Arial, sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    min-height: 100vh;
    display: flex; flex-direction: column;
  }
  header {
    background: var(--primary-color);
    color: white;
    padding: 1rem;
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
  }
  nav {
    display: flex;
    background: #e3e8f9;
    justify-content: center;
  }
  nav button {
    flex: 1;
    border: none;
    background: transparent;
    padding: 1rem;
    font-weight: 600;
    cursor: pointer;
    color: var(--primary-color);
    font-size: 1rem;
    transition: background 0.3s ease;
  }
  nav button[aria-selected="true"] {
    background: var(--primary-color);
    color: white;
  }
  nav button:hover:not([aria-selected="true"]) {
    background: #c5cffa;
  }
  main {
    flex: 1;
    padding: 1rem;
    max-width: 700px;
    margin: auto;
    width: 100%;
  }
  .tool-icons {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
    margin-bottom: 1rem;
  }
  .icon-card {
    background: white;
    border-radius: 10px;
    padding: 1rem;
    width: 120px;
    height: 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    transition: transform 0.15s ease, box-shadow 0.15s ease;
    user-select: none;
    text-align: center;
    font-size: 0.9rem;
    color: var(--primary-color);
  }
  .icon-card svg {
    width: 48px;
    height: 48px;
    margin-bottom: 0.5rem;
    fill: var(--primary-color);
  }
  .icon-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgb(0 0 0 / 0.2);
  }
  .tool-interface {
    background: white;
    border-radius: 10px;
    padding: 1rem;
    box-shadow: 0 2px 10px rgb(0 0 0 / 0.1);
    min-height: 250px;
  }
  label {
    display: block;
    margin: 0.7rem 0 0.3rem;
  }
  input[type="file"], input[type="text"], input[type="number"], textarea {
    width: 100%;
    padding: 0.4rem;
    font-size: 1rem;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  button.tool-btn {
    margin-top: 1rem;
    padding: 0.6rem 1.2rem;
    background: var(--primary-color);
    color: white;
    font-weight: 600;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
  }
  button.tool-btn:disabled {
    background: #a3a9c6;
    cursor: not-allowed;
  }
  .output {
    margin-top: 1rem;
    font-weight: 600;
    color: var(--primary-color);
    word-break: break-word;
  }
  a.download-link {
    color: var(--primary-color);
    font-weight: 700;
    text-decoration: none;
  }
  a.download-link:hover {
    text-decoration: underline;
  }
  @media (max-width: 480px) {
    .icon-card {
      width: 90px;
      height: 90px;
      font-size: 0.8rem;
    }
    .icon-card svg {
      width: 36px;
      height: 36px;
      margin-bottom: 0.3rem;
    }
  }
</style>
</head>
<body>

<header>PDFLY - PDF Tools</header>
<nav role="tablist" aria-label="PDF tools tabs">
  <button role="tab" aria-selected="true" aria-controls="panel-merge" id="tab-merge">Merge PDF</button>
  <button role="tab" aria-selected="false" aria-controls="panel-split" id="tab-split">Split PDF</button>
  <button role="tab" aria-selected="false" aria-controls="panel-compress" id="tab-compress">Compress PDF</button>
  <button role="tab" aria-selected="false" aria-controls="panel-convert-word" id="tab-convert-word">PDF to Word</button>
  <button role="tab" aria-selected="false" aria-controls="panel-convert-excel" id="tab-convert-excel">PDF to Excel</button>
</nav>

<main>
  <section tabindex="0" role="tabpanel" aria-labelledby="tab-merge" id="panel-merge">
    <h2>Merge PDF Files</h2>
    <label for="merge-files">Select PDF files to merge (2 or more):</label>
    <input type="file" id="merge-files" accept="application/pdf" multiple />
    <button id="merge-btn" class="tool-btn" disabled>Merge PDFs</button>
    <div id="merge-output" class="output" aria-live="polite"></div>
  </section>

  <section tabindex="0" role="tabpanel" aria-labelledby="tab-split" id="panel-split" hidden>
    <h2>Split PDF</h2>
    <label for="split-file">Select a PDF file to split:</label>
    <input type="file" id="split-file" accept="application/pdf" />
    <label for="split-pages">Enter pages to extract (e.g., 1-3,5,7):</label>
    <input type="text" id="split-pages" placeholder="1-3,5,7" />
    <button id="split-btn" class="tool-btn" disabled>Split PDF</button>
    <div id="split-output" class="output" aria-live="polite"></div>
  </section>

  <section tabindex="0" role="tabpanel" aria-labelledby="tab-compress" id="panel-compress" hidden>
    <h2>Compress PDF</h2>
    <label for="compress-file">Select a PDF file to compress:</label>
    <input type="file" id="compress-file" accept="application/pdf" />
    <button id="compress-btn" class="tool-btn" disabled>Compress PDF</button>
    <div id="compress-output" class="output" aria-live="polite"></div>
  </section>

  <section tabindex="0" role="tabpanel" aria-labelledby="tab-convert-word" id="panel-convert-word" hidden>
    <h2>Convert PDF to Word</h2>
    <p><em>Client-side PDF to Word conversion is not supported yet. This feature will be available in future with server-side or third-party API support.</em></p>
    <label for="convert-word-file">Select a PDF file:</label>
    <input type="file" id="convert-word-file" accept="application/pdf" />
  </section>

  <section tabindex="0" role="tabpanel" aria-labelledby="tab-convert-excel" id="panel-convert-excel" hidden>
    <h2>Convert PDF to Excel</h2>
    <p><em>Client-side PDF to Excel conversion is not supported yet. This feature will be available in future with server-side or third-party API support.</em></p>
    <label for="convert-excel-file">Select a PDF file:</label>
    <input type="file" id="convert-excel-file" accept="application/pdf" />
  </section>
</main>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script>
(() => {
  const tabs = [...document.querySelectorAll('nav button[role="tab"]')];
  const panels = tabs.map(t => document.getElementById(t.getAttribute('aria-controls')));

  // --- Tab switching ---
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => {
        t.setAttribute('aria-selected', 'false');
        document.getElementById(t.getAttribute('aria-controls')).hidden = true;
      });
      tab.setAttribute('aria-selected', 'true');
      document.getElementById(tab.getAttribute('aria-controls')).hidden = false;
      document.getElementById(tab.getAttribute('aria-controls')).focus();
    });
  });

  // --- Merge PDF ---
  const mergeFilesInput = document.getElementById('merge-files');
  const mergeBtn = document.getElementById('merge-btn');
  const mergeOutput = document.getElementById('merge-output');

  mergeFilesInput.addEventListener('change', () => {
    mergeBtn.disabled = mergeFilesInput.files.length < 2;
    mergeOutput.textContent = '';
  });

  mergeBtn.addEventListener('click', async () => {
    mergeBtn.disabled = true;
    mergeOutput.textContent = 'Merging PDFs... please wait.';
    try {
      const mergedPdf = await PDFLib.PDFDocument.create();

      for (const file of mergeFilesInput.files) {
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        const copiedPages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
        copiedPages.forEach(page => mergedPdf.addPage(page));
      }

      const mergedBytes = await mergedPdf.save();
      const blob = new Blob([mergedBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      mergeOutput.innerHTML = `<a href="${url}" download="merged.pdf" class="download-link">Download Merged PDF</a>`;
    } catch (err) {
      mergeOutput.textContent = 'Error merging PDFs: ' + err.message;
    }
    mergeBtn.disabled = false;
  });

  // --- Split PDF ---
  const splitFileInput = document.getElementById('split-file');
  const splitPagesInput = document.getElementById('split-pages');
  const splitBtn = document.getElementById('split-btn');
  const splitOutput = document.getElementById('split-output');

  function parsePagesInput(input, maxPage) {
    const pagesSet = new Set();
    const parts = input.split(',');
    for (let part of parts) {
      part = part.trim();
      if (part.includes('-')) {
        const [start, end] = part.split('-').map(x => parseInt(x.trim(), 10));
        if (!isNaN(start) && !isNaN(end) && start > 0 && end >= start) {
          for (let i = start; i <= end && i <= maxPage; i++) pagesSet.add(i);
        }
      } else {
        const num = parseInt(part, 10);
        if (!isNaN(num) && num > 0 && num <= maxPage) pagesSet.add(num);
      }
    }
    return Array.from(pagesSet).sort((a, b) => a - b);
  }

  function validateSplit() {
    splitBtn.disabled = !splitFileInput.files.length || !splitPagesInput.value.trim();
    splitOutput.textContent = '';
  }

  splitFileInput.addEventListener('change', validateSplit);
  splitPagesInput.addEventListener('input', validateSplit);

  splitBtn.addEventListener('click', async () => {
    splitBtn.disabled = true;
    splitOutput.textContent = 'Splitting PDF... please wait.';
    try {
      const arrayBuffer = await splitFileInput.files[0].arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
      const totalPages = pdfDoc.getPageCount();

      const pagesToExtract = parsePagesInput(splitPagesInput.value, totalPages);
      if (pagesToExtract.length === 0) {
        splitOutput.textContent = 'No valid pages specified.';
        splitBtn.disabled = false;
        return;
      }

      const newPdf = await PDFLib.PDFDocument.create();
      for (const p of pagesToExtract) {
        const [copiedPage] = await newPdf.copyPages(pdfDoc, [p - 1]);
        newPdf.addPage(copiedPage);
      }
      const pdfBytes = await newPdf.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      splitOutput.innerHTML = `<a href="${url}" download="split.pdf" class="download-link">Download Split PDF</a>`;
    } catch (err) {
      splitOutput.textContent = 'Error splitting PDF: ' + err.message;
    }
    splitBtn.disabled = false;
  });

  // --- Compress PDF ---
  const compressFileInput = document.getElementById('compress-file');
  const compressBtn = document.getElementById('compress-btn');
  const compressOutput = document.getElementById('compress-output');

  compressFileInput.addEventListener('change', () => {
    compressBtn.disabled = compressFileInput.files.length === 0;
    compressOutput.textContent = '';
  });

  compressBtn.addEventListener('click', async () => {
    compressBtn.disabled = true;
    compressOutput.textContent = 'Compressing PDF... please wait.';

    try {
      const arrayBuffer = await compressFileInput.files[0].arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

      // Simple compression: For each page, reduce images by lowering their quality
      // Note: pdf-lib doesn't support image compression directly, so this is a placeholder showing basic approach.

      // We will re-save the PDF as is since client-side image compression in PDFs is complex
      // For demo: just re-save and show message about actual compression limits on client side

      const compressedBytes = await pdfDoc.save();

      const originalSize = compressFileInput.files[0].size;
      const compressedSize = compressedBytes.byteLength;

      const blob = new Blob([compressedBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);

      compressOutput.innerHTML = `
        <p>Original size: ${(originalSize / 1024).toFixed(2)} KB</p>
        <p>Compressed size: ${(compressedSize / 1024).toFixed(2)} KB</p>
        <a href="${url}" download="compressed.pdf" class="download-link">Download Compressed PDF</a>
        <p><em>Note: Client-side compression is limited. For better compression, consider server-side tools.</em></p>
      `;
    } catch (err) {
      compressOutput.textContent = 'Error compressing PDF: ' + err.message;
    }

    compressBtn.disabled = false;
  });
})();
</script>
</body>
</html>
