<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PDFLY - PDF Tools</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background:#f4f6f8; color:#333; }
  header { background:#0052cc; color:#fff; padding:1rem; text-align:center; }
  h1 { margin: 0; }
  nav { display: flex; justify-content:center; background:#003d99; }
  nav button { background:none; border:none; color:#fff; padding:1rem 2rem; cursor:pointer; font-weight:bold; }
  nav button.active { background:#002766; }
  section { max-width:900px; margin:2rem auto; background:#fff; padding:1.5rem; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  input, button { padding:0.5rem; font-size:1rem; }
  input[type=file] { margin-bottom:1rem; }
  button { cursor:pointer; background:#0052cc; color:#fff; border:none; border-radius:4px; transition:background 0.3s; }
  button:hover { background:#003d99; }
  .output { margin-top:1rem; white-space: pre-wrap; background:#eef2f7; padding:1rem; border-radius:4px; max-height:300px; overflow:auto; }
  #mergeList, #splitList { margin-top:1rem; }
  #mergeList ul, #splitList ul { list-style:none; padding-left:0; }
  #mergeList li, #splitList li { margin:0.3rem 0; }
  .hidden { display:none; }
  .flex-row { display:flex; gap:1rem; flex-wrap: wrap; align-items: center; }
</style>
</head>
<body>

<header>
  <h1>PDFLY - PDF Tools</h1>
</header>

<nav>
  <button class="tab-btn active" data-tab="convert">Convert</button>
  <button class="tab-btn" data-tab="merge">Merge PDF</button>
  <button class="tab-btn" data-tab="split">Split PDF</button>
  <button class="tab-btn" data-tab="compress">Compress PDF</button>
</nav>

<section id="convert" class="tab-content">
  <h2>Convert PDF to Word or Excel</h2>
  <input type="file" id="convertPdfInput" accept="application/pdf" />
  <div class="flex-row">
    <button id="pdfToWordBtn">Convert to Word (.doc)</button>
    <button id="pdfToExcelBtn">Convert to Excel (.csv)</button>
  </div>
  <div id="convertOutput" class="output"></div>
</section>

<section id="merge" class="tab-content hidden">
  <h2>Merge Multiple PDFs</h2>
  <input type="file" id="mergePdfInput" accept="application/pdf" multiple />
  <button id="mergeBtn">Merge PDFs</button>
  <div id="mergeList"></div>
</section>

<section id="split" class="tab-content hidden">
  <h2>Split PDF</h2>
  <input type="file" id="splitPdfInput" accept="application/pdf" />
  <label>Pages to extract (e.g. 1,3-5):</label>
  <input type="text" id="splitPages" placeholder="Enter pages to extract" />
  <button id="splitBtn">Split PDF</button>
  <div id="splitList"></div>
</section>

<section id="compress" class="tab-content hidden">
  <h2>Compress PDF</h2>
  <input type="file" id="compressPdfInput" accept="application/pdf" />
  <button id="compressBtn">Compress PDF</button>
  <div id="compressList"></div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfjs-dist/2.14.305/pdf.min.js"></script>

<script>
  // Tab switching
  const tabs = document.querySelectorAll('.tab-btn');
  const contents = document.querySelectorAll('.tab-content');
  tabs.forEach(btn => {
    btn.addEventListener('click', () => {
      tabs.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.getAttribute('data-tab');
      contents.forEach(c => c.classList.add('hidden'));
      document.getElementById(tab).classList.remove('hidden');
    });
  });

  // Utility: Download file
  function download(filename, data, type) {
    const blob = new Blob([data], {type});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }

  // Convert PDF to Word (extract text)
  document.getElementById('pdfToWordBtn').onclick = async () => {
    const input = document.getElementById('convertPdfInput');
    const output = document.getElementById('convertOutput');
    if (!input.files.length) {
      output.textContent = 'Please select a PDF file.';
      return;
    }
    output.textContent = 'Processing...';
    const file = input.files[0];
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
    let fullText = '';
    for(let i=1; i<=pdf.numPages; i++){
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const strings = content.items.map(item => item.str);
      fullText += strings.join(' ') + '\n\n';
    }
    // Prepare simple Word content as plain text
    const wordContent = fullText;
    download(file.name.replace(/\.pdf$/i,'.doc'), wordContent, 'application/msword');
    output.textContent = 'Download started: ' + file.name.replace(/\.pdf$/i,'.doc');
  };

  // Convert PDF to Excel (extract tables as CSV)
  document.getElementById('pdfToExcelBtn').onclick = async () => {
    const input = document.getElementById('convertPdfInput');
    const output = document.getElementById('convertOutput');
    if (!input.files.length) {
      output.textContent = 'Please select a PDF file.';
      return;
    }
    output.textContent = 'Processing...';
    const file = input.files[0];
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;

    // Naive extraction: gather all text with commas (no real table detection)
    // Real table extraction requires complex parsing, here we output text separated by commas per item
    let csvContent = '';
    for(let i=1; i<=pdf.numPages; i++){
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const rows = [];
      // group strings by y position roughly to rows
      let lastY = null;
      let currentRow = [];
      content.items.forEach(item => {
        if (lastY === null || Math.abs(item.transform[5] - lastY) < 5) {
          currentRow.push(item.str);
        } else {
          rows.push(currentRow);
          currentRow = [item.str];
        }
        lastY = item.transform[5];
      });
      if(currentRow.length) rows.push(currentRow);
      rows.forEach(row => {
        csvContent += row.join(',') + '\n';
      });
    }
    download(file.name.replace(/\.pdf$/i,'.csv'), csvContent, 'text/csv');
    output.textContent = 'Download started: ' + file.name.replace(/\.pdf$/i,'.csv');
  };

  // Merge PDFs
  document.getElementById('mergeBtn').onclick = async () => {
    const input = document.getElementById('mergePdfInput');
    const output = document.getElementById('mergeList');
    if (!input.files.length || input.files.length < 2) {
      output.textContent = 'Please select at least two PDF files.';
      return;
    }
    output.textContent = 'Merging PDFs...';
    const mergedPdf = await PDFLib.PDFDocument.create();
    for(const file of input.files) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
      const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
      copiedPages.forEach((page) => mergedPdf.addPage(page));
    }
    const mergedPdfFile = await mergedPdf.save();
    download('merged.pdf', mergedPdfFile, 'application/pdf');
    output.textContent = 'Download started: merged.pdf';
  };

  // Split PDF
  document.getElementById('splitBtn').onclick = async () => {
    const input = document.getElementById('splitPdfInput');
    const pagesInput = document.getElementById('splitPages');
    const output = document.getElementById('splitList');
    if (!input.files.length) {
      output.textContent = 'Please select a PDF file.';
      return;
    }
    if (!pagesInput.value.trim()) {
      output.textContent = 'Please enter pages to extract.';
      return;
    }
    output.textContent = 'Processing...';
    const pagesToExtract = parsePagesInput(pagesInput.value);
    if (!pagesToExtract.length) {
      output.textContent = 'Invalid pages format.';
      return;
    }
    const arrayBuffer = await input.files[0].arrayBuffer();
    const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
    const newPdf = await PDFLib.PDFDocument.create();
    const totalPages = pdf.getPageCount();
    for (const p of pagesToExtract) {
      if (p < 1 || p > totalPages) continue;
      const [copiedPage] = await newPdf.copyPages(pdf, [p - 1]);
      newPdf.addPage(copiedPage);
    }
    const newPdfFile = await newPdf.save();
    download('split.pdf', newPdfFile, 'application/pdf');
    output.textContent = 'Download started: split.pdf';
  };

  function parsePagesInput(input) {
    // Parses input like "1,3-5" to array [1,3,4,5]
    const parts = input.split(',');
    const pages = [];
    parts.forEach(part => {
      if (part.includes('-')) {
        const [start, end] = part.split('-').map(n => parseInt(n));
        if (!isNaN(start) && !isNaN(end) && start <= end) {
          for (let i = start; i <= end; i++) pages.push(i);
        }
      } else {
        const n = parseInt(part);
        if (!isNaN(n)) pages.push(n);
      }
    });
    return pages;
  }

  // Compress PDF - very basic: reduces image quality by re-encoding pages
  document.getElementById('compressBtn').onclick = async () => {
    const input = document.getElementById('compressPdfInput');
    const output = document.getElementById('compressList');
    if (!input.files.length) {
      output.textContent = 'Please select a PDF file.';
      return;
    }
    output.textContent = 'Compressing...';
    try {
      const arrayBuffer = await input.files[0].arrayBuffer();
      const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
      // This is a placeholder - real compression needs complex logic or server side
      // Here we just save it again to reduce some metadata and compress streams minimally
      const compressedPdfFile = await pdf.save({useObjectStreams:true});
      download('compressed.pdf', compressedPdfFile, 'application/pdf');
      output.textContent = 'Download started: compressed.pdf';
    } catch(e) {
      output.textContent = 'Compression failed: ' + e.message;
    }
  };
</script>

</body>
</html>
